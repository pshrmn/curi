<!doctype html>
<html lang="en" class="font-serif text-small-screen md:text-regular-screen font-light m-0 box-border">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="undefined">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React Advanced Tutorial | Curi Documentation</title>
    <link href="https://fonts.googleapis.com/css?family=Zilla+Slab:300,400" rel="stylesheet">
    <link href="/static/css/prism.css" rel="stylesheet">
    <link href="/static/index.css" rel="stylesheet">
  </head>
  <body>
    <div id="root"><header class="hidden md:block w-screen max-w-full bg-purple p-0 fixed z-10"><nav class="text-gray-100"><ul role="menubar" class="flex flex-row flex-wrap items-end p-0 m-0 max-w-full"><li class="p-0 pr-2 pl-0"><a class=" text-gray-100 text-xl no-underline h-10 flex items-center px-2 border-0 border-b-2 border-purple hover:text-bright-orange md:text-2xl md:text-bright-orange" href="/">Curi</a></li><li class="p-0 pr-2 pl-0" aria-haspopup="true"><a class=" text-gray-100 text-xl no-underline h-10 flex items-center px-2 border-0 border-b-2 border-purple hover:text-bright-orange " href="/v2/">API</a><div class="hidden absolute w-screen left-0 text-purple border-0 border-b-2 border-purple"><ul class="flex flex-row flex-no-wrap justify-start bg-light-blue list-none m-0 p-0"><li><menu class="my-0 mx-5"><h3>router</h3><ul><li><a class=" " href="/v2/@curi/router/">router</a></li><li><a class=" " href="/v2/@curi/interactions/">interactions</a></li></ul></menu></li><li><menu class="my-0 mx-5"><h3>render</h3><ul><li><a class=" " href="/v2/@curi/react-dom/">react-dom</a></li><li><a class=" " href="/v2/@curi/react-native/">react-native</a></li><li><a class=" " href="/v2/@curi/svelte/">svelte</a></li><li><a class=" " href="/v2/@curi/vue/">vue</a></li></ul></menu></li><li><menu class="my-0 mx-5"><h3>other</h3><ul><li><a class=" " href="/v2/@curi/static/">static</a></li><li><a class=" " href="/v2/@curi/helpers/">helpers</a></li><li><a class=" " href="/v2/@curi/types/">types</a></li></ul></menu></li></ul></div></li><li class="p-0 pr-2 pl-0" aria-haspopup="true"><a class=" text-gray-100 text-xl no-underline h-10 flex items-center px-2 border-0 border-b-2 border-purple hover:text-bright-orange " href="/guides/">Guides</a><div class="hidden absolute w-screen left-0 text-purple border-0 border-b-2 border-purple"><ul class="flex flex-row flex-no-wrap justify-start bg-light-blue list-none m-0 p-0"><menu class="my-0 mx-5"><h3>basic</h3><ul><li><a class=" " href="/guides/installation/">Installation</a></li><li><a class=" " href="/guides/getting-started/">Getting Started</a></li><li><a class=" " href="/guides/history/">History</a></li><li><a class=" " href="/guides/routes/">Routes</a></li><li><a class=" " href="/guides/responses/">Responses</a></li><li><a class=" " href="/guides/navigation-objects/">Navigation Objects</a></li><li><a class=" " href="/guides/sync-or-async/">Sync or Async</a></li><li><a class=" " href="/guides/new-responses/">New Responses</a></li><li><a class=" " href="/guides/accessibility/">Accessibility</a></li></ul></menu><menu class="my-0 mx-5"><h3>rendering</h3><ul><li><a class=" " href="/guides/react-dom/">React DOM</a></li><li><a class=" " href="/guides/react-native/">React Native</a></li><li><a class=" " href="/guides/svelte/">Svelte</a></li><li><a class=" " href="/guides/vue/">Vue</a></li></ul></menu><menu class="my-0 mx-5"><h3>advanced</h3><ul><li><a class=" " href="/guides/route-interactions/">Route Interactions</a></li><li><a class=" " href="/guides/side-effects/">Side Effects</a></li><li><a class=" " href="/guides/code-splitting/">Code Splitting</a></li><li><a class=" " href="/guides/loading/">Loading Route Data</a></li><li><a class=" " href="/guides/ssr/">Server-Side Rendering</a></li><li><a class=" " href="/guides/apollo/">Apollo Integration</a></li></ul></menu></ul></div></li><li class="p-0 pr-2 pl-0" aria-haspopup="true"><a class="text-bright-orange border-bright-orange text-gray-100 text-xl no-underline h-10 flex items-center px-2 border-0 border-b-2 border-purple hover:text-bright-orange " href="/tutorial/">Tutorials</a><div class="hidden absolute w-screen left-0 text-purple border-0 border-b-2 border-purple"><ul class="flex flex-row flex-no-wrap justify-start bg-light-blue list-none m-0 p-0"><menu class="my-0 mx-5"><h3>Basic</h3><ul><li><a class=" " href="/tutorial/react-basics/">React Basics</a></li><li><a class=" " href="/tutorial/vue-basics/">Vue Basics</a></li></ul></menu><menu class="my-0 mx-5"><h3>Advanced</h3><ul><li><a class="font-bold " href="/tutorial/react-advanced/">React Advanced</a></li></ul></menu></ul></div></li><li class="p-0 pr-2 pl-0" aria-haspopup="true"><a class=" text-gray-100 text-xl no-underline h-10 flex items-center px-2 border-0 border-b-2 border-purple hover:text-bright-orange " href="/examples/">Examples</a><div class="hidden absolute w-screen left-0 text-purple border-0 border-b-2 border-purple"><ul class="flex flex-row flex-no-wrap justify-start bg-light-blue list-none m-0 p-0"><menu class="my-0 mx-5"><ul style="margin:0 25px"><li><a class=" " href="/examples/basic/">Basic</a></li><li><a class=" " href="/examples/accessibility/">Focus Management</a></li><li><a class=" " href="/examples/active/">Active Routes</a></li><li><a class=" " href="/examples/async/">Async Routes &amp; Navigation</a></li><li><a class=" " href="/examples/breadcrumbs/">Breadcrumbs</a></li><li><a class=" " href="/examples/confirmation/">Navigation Confirmation</a></li><li><a class=" " href="/examples/redirects/">Redirects</a></li><li><a class=" " href="/examples/multi-body/">Multiple Body Components</a></li><li><a class=" " href="/examples/transitions/">Route Transitions</a></li><li><a class=" " href="/examples/modal/">Modal Content</a></li><li><a class=" " href="/examples/spotify/">Spotify Clone</a></li><li><a class=" " href="/examples/twitch/">Twitch Clone</a></li><li><a class=" " href="/examples/code-splitting/">Code Splitting</a></li><li><a class=" " href="/examples/script-tags/">Script Tags</a></li><li><a class=" " href="/examples/server-rendering/">Server Rendering</a></li><li><a class=" " href="/examples/side-effects/">Side Effects</a></li></ul></menu></ul></div></li><li class="p-0 pr-2 pl-0"><a class="text-gray-100 text-xl no-underline h-10 flex items-center px-2 border-0 border-b-2 border-purple hover:text-bright-orange" href="https://github.com/pshrmn/curi">GitHub</a></li></ul></nav></header><menu class="fixed w-screen h-8 left-0 bottom-0 flex flex-row flex-no-wrap justify-between z-50"><button class="h-8 flex-grow text-xl border-0 bg-button-green md:hidden">Menu</button></menu><menu hidden="" class=" fixed overflow-y-scroll w-screen h-screen bg-gray-100 z-40 p-0 pb-10 md:hidden"><div data-reach-tabs=""><div data-reach-tab-list="" role="tablist"><button data-reach-tab="" role="tab" id="tab:null:0" tabindex="0" aria-selected="true" aria-controls="panel:null:0" data-selected="">Main</button><button data-reach-tab="" role="tab" id="tab:null:1" tabindex="-1" aria-selected="false" aria-controls="panel:null:1">Page</button></div><div data-reach-tab-panels="" class="py-0 px-3"><div data-reach-tab-panel="" role="tabpanel" tabindex="-1" aria-labelledby="tab:null:0" id="panel:null:0"><ul class="my-1 mx-0 p-0 list-none"><li><a class=" home-link" href="/">Curi</a></li><li><ul><li class="mb-3"><button title="Toggle group visibility" class="cursor-pointer text-left w-full bg-transparent border-0 p-0 text-purple"><svg width="25" height="15" viewBox="0 0 25 15" xmlns="http://www.w3.org/2000/svg" class="inline-block"><path d="M2,5 l5,5 l5,-5" fill="none" stroke="black" stroke-width="3"></path></svg>API</button></li></ul></li><li><ul><li class="mb-3"><button title="Toggle group visibility" class="cursor-pointer text-left w-full bg-transparent border-0 p-0 text-purple"><svg width="25" height="15" viewBox="0 0 25 15" xmlns="http://www.w3.org/2000/svg" class="inline-block"><path d="M2,5 l5,5 l5,-5" fill="none" stroke="black" stroke-width="3"></path></svg>Guides</button></li></ul></li><li><ul><li class="mb-3"><button title="Toggle group visibility" class="cursor-pointer text-left w-full bg-transparent border-0 p-0 text-purple"><svg width="25" height="15" viewBox="0 0 25 15" xmlns="http://www.w3.org/2000/svg" class="inline-block"><path d="M2,5 l5,5 l5,-5" fill="none" stroke="black" stroke-width="3"></path></svg>Tutorials</button></li></ul></li><li><ul><li class="mb-3"><button title="Toggle group visibility" class="cursor-pointer text-left w-full bg-transparent border-0 p-0 text-purple"><svg width="25" height="15" viewBox="0 0 25 15" xmlns="http://www.w3.org/2000/svg" class="inline-block"><path d="M2,5 l5,5 l5,-5" fill="none" stroke="black" stroke-width="3"></path></svg>Examples</button></li></ul></li><li><a href="https://github.com/pshrmn/curi">GitHub</a></li></ul></div><div data-reach-tab-panel="" role="tabpanel" tabindex="-1" aria-labelledby="tab:null:1" hidden="" id="panel:null:1"><menu class="max-w-full p-0 m-0"><ol class="my-1 mx-0 p-0 list-none p-0"><li><a class="no-underline" href="#demo">Demo</a></li><li><a class="no-underline" href="#setup">Setup</a></li><li><a class="no-underline" href="#async">Asynchronous Routes</a><ol class="my-1 mx-0 p-0 list-none pl-3"><li><a class="no-underline" href="#initial-render">Initial Render</a></li></ol></li><li><a class="no-underline" href="#code-splitting-routes">Code Splitting in Routes</a><ol class="my-1 mx-0 p-0 list-none pl-3"><li><a class="no-underline" href="#code-splitting">Code Splitting</a></li></ol></li><li><a class="no-underline" href="#preloading-data">Preloading Data</a><ol class="my-1 mx-0 p-0 list-none pl-3"><li><a class="no-underline" href="#fake-api">The Fake API</a></li></ol></li><li><a class="no-underline" href="#loading">Visualizing Loading</a><ol class="my-1 mx-0 p-0 list-none pl-3"><li><a class="no-underline" href="#link-navigating">Link is navigating?</a></li></ol></li><li><a class="no-underline" href="#caveats">Async Caveats</a></li></ol></menu></div></div></div></menu><main tabindex="-1" class="w-screen max-w-full pt-3 px-3 pb-0 mb-10 md:pt-10 md:px-0 md:mb-0"><div class="relative md:flex md:flex-row md:flex-no-wrap md:max-w-full"><div class="hidden md:block md:w-64 md:bg-gray-100 md:fixed md:bottom-0 md:overflow-auto md:flex-grow-0 md:flex-shrink-0 md:p-6 md:mr-6" style="top:2rem"><menu class="max-w-full p-0 m-0"><ol class="my-1 mx-0 p-0 list-none p-0"><li><a class="no-underline" href="#demo">Demo</a></li><li><a class="no-underline" href="#setup">Setup</a></li><li><a class="no-underline" href="#async">Asynchronous Routes</a><ol class="my-1 mx-0 p-0 list-none pl-3"><li><a class="no-underline" href="#initial-render">Initial Render</a></li></ol></li><li><a class="no-underline" href="#code-splitting-routes">Code Splitting in Routes</a><ol class="my-1 mx-0 p-0 list-none pl-3"><li><a class="no-underline" href="#code-splitting">Code Splitting</a></li></ol></li><li><a class="no-underline" href="#preloading-data">Preloading Data</a><ol class="my-1 mx-0 p-0 list-none pl-3"><li><a class="no-underline" href="#fake-api">The Fake API</a></li></ol></li><li><a class="no-underline" href="#loading">Visualizing Loading</a><ol class="my-1 mx-0 p-0 list-none pl-3"><li><a class="no-underline" href="#link-navigating">Link is navigating?</a></li></ol></li><li><a class="no-underline" href="#caveats">Async Caveats</a></li></ol></menu></div><article class="md:ml-64 md:pl-8"><section class="mt-3 md:max-w-2xl "><h1 class="outline-none" tabindex="-1">React Advanced Tutorial</h1><p class="m-0 mb-4 text-base md:text-lg ">In this tutorial, we will be expanding on the website built in the<!-- --> <a href="/tutorial/react-basics/">React basics tutorial</a>. We will take advantage of Curi&#x27;s async features to add code splitting and data preloading to the application.</p><aside class="border border-border-blue p-2 my-1 mx-0 bg-light-blue"><p class="m-0"><strong>We will be doing the following:</strong></p><ul class="list-inside list-disc ml-5"><li>Add code splitting to routes.</li><li>Preload route data with asynchronous navigation.</li></ul></aside></section><section class="mt-3 md:max-w-2xl"><h2 id="demo" class="hash-anchor-fix outline-none" tabindex="-1"><a class="header-link no-underline" href="#demo">Demo</a></h2><p class="m-0 mb-4 text-base md:text-lg ">You can run a demo of the site we are building with CodeSandbox.</p><figure class="md:w-4/5 md:my-0 md:mx-auto"><iframe src="https://codesandbox.io/embed/github/curijs/react-advanced-tutorial/tree/master/?view=split" width="100%" height="600px" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin" tabindex="-1"></iframe><p class="m-0 text-center italic">Use the three buttons at the top of the Sandbox to toggle view modes. Clicking the menu button in the top left corner opens a menu to switch between files.</p></figure></section><section class="mt-3 md:max-w-2xl"><h2 id="setup" class="hash-anchor-fix outline-none" tabindex="-1"><a class="header-link no-underline" href="#setup">Setup</a></h2><p class="m-0 mb-4 text-base md:text-lg ">If you did not complete the React basics tutorial, you should either clone its<!-- --> <a href="https://github.com/curijs/react-basic-tutorial/">repo</a> or fork its<!-- --> <a href="https://codesandbox.io/s/github/curijs/react-basic-tutorial/tree/master/">sandbox</a>.</p><p class="m-0 mb-4 text-base md:text-lg ">If you are cloning the repo, you should also install its dependencies and then start the development server.</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-bash md:whitespace-pre-wrap">git clone https://github.com/curijs/react-basic-tutorial react-advanced-tutorial
cd react-advanced-tutorial
npm install
npm run start</code></pre></figure></section><section class="mt-3 md:max-w-2xl"><h2 id="async" class="hash-anchor-fix outline-none" tabindex="-1"><a class="header-link no-underline" href="#async">Asynchronous Routes</a></h2><p class="m-0 mb-4 text-base md:text-lg ">Curi lets you attach async functions to a route through its<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">resolve</code> function. When that route matches, a response will not be emitted until the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">resolve</code> has resolved.</p><p class="m-0 mb-4 text-base md:text-lg "><code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">resolve</code> be passed an object of the matched route properties, which you may use to specify what data to load.</p><p class="m-0 mb-4 text-base md:text-lg ">The results of the async functions will be available in a route&#x27;s<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">respond</code> function through the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">resolved</code> object. Each result will be stored in the object using the async function&#x27;s name.</p><p class="m-0 mb-4 text-base md:text-lg ">If any of the async functions throws an uncaught error, that error will be available in the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">respond</code> function through the<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">error</code> property. That said, it is preferable for you to catch and handle the errors yourself.</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">{
  name: &quot;A Route&quot;,
  path: &quot;route/:id&quot;,
  resolve({ params }) {
    let body = import(&quot;./components/SomeComponent&quot;)
      .then(preferDefault);
    let data = fetch(`/api/data/${params.id}`);
    return Promise.all([ component, data ]);
  },
  respond({ resolved, error }) {
    if (error) {
      // handle an uncaught error
    }
    let [body, data] = resolved;
    return { body, data };
  }
}</code></pre></figure><aside class="py-2 px-1 my-1 mx-0 border-gray-300 bg-gray-200"><strong>Note:</strong> <p class="m-0 mb-4 text-base md:text-lg ">These async functions are called every time a route matches. If you have functions that should re-use the results from previous calls, you will probably want to implement some caching. Curi provides a<!-- --> <a href="/v2/@curi/helpers/#once"><code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">once</code></a> <!-- -->function for simple caching, but leaves more advanced caching solutions to the user.</p></aside><p class="m-0 mb-4 text-base md:text-lg ">Curi uses Promises to manage async code, so async functions should return Promises. <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Promise.resolve</code> can be used to wrap a return value in a Promise.</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">import { preferDefault } from &quot;@curi/helpers&quot;;

let routes = prepareRoutes([
  {
    name: &quot;A Route&quot;,
    path: &quot;route/:id&quot;,
    resolve({ params }) {
      let body = import(&quot;./components/SomeComponent&quot;)
        .then(preferDefault);
      let data = fetch(`/api/data/${params.id}`);
      return Promise.all([ component, data ]);
    },
    respond({ resolved, error }) {
      if (error) {
        // handle an uncaught error
      }
      let [body, data] = resolved;
      return { body, data };
    }
  }
]);</code></pre></figure><section class="mt-3 md:max-w-2xl py-1 px-2 border-l-2 border-border-green bg-light-green "><h3 id="initial-render" class="hash-anchor-fix outline-none" tabindex="-1"><a class="header-link no-underline" href="#initial-render">Initial Render</a></h3><p class="m-0 mb-4 text-base md:text-lg ">There is one caveat to async routes: we cannot safely render the application immediately on load because the initial response might not be ready yet.</p><p class="m-0 mb-4 text-base md:text-lg ">Curi does not emit a response object to its observers until it is ready. If the initial route that matches is asynchronous, then there is a delay between when the application is ready to render and when there is a response to render.</p><p class="m-0 mb-4 text-base md:text-lg ">If you attempt to render immediately after creating a router and the initial response is still being created, the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">response</code> <!-- -->that will be passed to the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Router</code>&#x27;s <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">children</code> <!-- -->will be <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">undefined</code>.</p><p class="m-0 mb-4 text-base md:text-lg ">There are a few possible ways to handle this situation.</p><p class="m-0 mb-4 text-base md:text-lg ">The first is to delay rendering by placing your<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">ReactDOM.render</code> call inside of a <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">router.once</code> <!-- -->callback. This will guarantee that the render isn&#x27;t called until the first response is ready.</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">// delay rendering
router.once(() =&gt; {
  ReactDOM.render((
    &lt;Router&gt;
      &lt;App /&gt;
    &lt;/Router&gt;
  ), holder);
});
</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg ">Alternatively, you can update the root <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">App</code> component to detect when the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">response</code> is <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">undefined</code> and render a loading message.</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">// render fallback when response is null
function App() {
  let { response } = useResponse();
  if (response === undefined) {
    return &lt;Paragraph&gt;Loading...&lt;/Paragraph&gt;;
  }
  let { body:Body } = response;
  return &lt;Body response={response} /&gt;;
}</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg ">Which approach is best will depend on the specifics of an application. If there are routes that will take a long time for the initial load, you will probably want to render something while they load. For async code with short loading times, a blank screen might be more acceptable.</p></section><p class="m-0 mb-4 text-base md:text-lg ">For more information on async route properties, please refer to the<!-- --> <a href="/guides/routes/">routes guide</a>.</p></section><section class="mt-3 md:max-w-2xl"><h2 id="code-splitting-routes" class="hash-anchor-fix outline-none" tabindex="-1"><a class="header-link no-underline" href="#code-splitting-routes">Code Splitting in Routes</a></h2><p class="m-0 mb-4 text-base md:text-lg ">Currently, the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">routes.js</code> module imports all of the route modules at the top of the file. This results in a single bundle of all of a website&#x27;s code. This can be improved by adding code splitting to an application, which will result in more, but smaller, bundles.</p><section class="mt-3 md:max-w-2xl py-1 px-2 border-l-2 border-border-green bg-light-green "><h3 id="code-splitting" class="hash-anchor-fix outline-none" tabindex="-1"><a class="header-link no-underline" href="#code-splitting">Code Splitting</a></h3><p class="m-0 mb-4 text-base md:text-lg ">Code splitting works by &quot;dynamically&quot; importing modules using the<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">import</code> function. When bundlers like Webpack see<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">import</code> functions, they know to create a separate bundle for that module (and that module&#x27;s imports, etc.).</p><p class="m-0 mb-4 text-base md:text-lg ">You can set a chunk&#x27;s name using the<!-- --> <a href="https://webpack.js.org/api/module-methods/#magic-comments"><code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">webpackChunkName</code></a> <!-- -->magic comment with an <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">import</code> call.</p><p class="m-0 mb-4 text-base md:text-lg ">Create React App&#x27;s default configuration is already setup to support code splitting, but if you were creating your own Webpack configuration, you would need to use<!-- --> <a href="https://webpack.js.org/configuration/output/#output-chunkfilename"><code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">output.chunkFilename</code></a> <!-- -->to support code splitting.</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">// this creates a &quot;Test&quot; bundle
import(/* webpackChunkName: &quot;Test&quot; */ &quot;./components/Test.js&quot;)</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg "><code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">import</code> returns a module object, so if you want to access a module&#x27;s default export, you can use a <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">then</code> function to get that value.</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">import(&quot;some-module.js&quot;)
  .then(module =&gt; module.default)</code></pre></figure></section><p class="m-0 mb-4 text-base md:text-lg ">Currently <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">respond</code> function returns an object whose<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">body</code> property is a module imported at the top of the file. In order to add code splitting to routes, we can add a<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">resolve</code> function that imports the module.</p><p class="m-0 mb-4 text-base md:text-lg ">The <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">@curi/helpers</code> package provides a<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">preferDefault</code> function. This function will return an imported module&#x27;s default property if it exists, and returns the entire module if it doesn&#x27;t have a default property.</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">import { preferDefault } from &quot;@curi/helpers&quot;;

let routes = prepareRoutes([
  {
    name: &quot;Test&quot;,
    path: &quot;test&quot;,
    resolve() {
      return import(
        /* webpackChunkName: &quot;Test&quot; */ &quot;./components/Test.js&quot;
      ).then(preferDefault);
    }
  }
]);</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg ">When a module fails to load, the error will be passed to the<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">respond</code> function through the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">error</code> property. We won&#x27;t be incorporating this into the application here, but in a real application you probably want to have a fallback component to display an error message (especially if you have an offline mode with service workers).</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">import displayLoadError from &quot;./components/LoadError&quot;;

let routes = prepareRoutes([
  {
    name: &quot;One&quot;,
    path: &quot;one&quot;,
    resolve() {
      return import(&quot;./components/One.js&quot;)
        .then(preferDefault)
        .catch(err =&gt; displayLoadError(err);
    },
    respond({ resolved }) {
      return {
        body: resolved
      };
    }
  }
]);</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg ">We can now update the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">routes.js</code> module to remove the imports at the top of the file and use <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">import</code> to import the route components. We will use <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">preferDefault</code> to only resolve the component instead of the entire module object.</p><p class="m-0 mb-4 text-base md:text-lg ">The <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">respond</code> functions should also be updated to set the return object&#x27;s <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">body</code> property to <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">resolved.body</code> <!-- -->instead of the import at the top of the file.</p><figure class="m-0 mb-4"><pre data-line="3,10-16,21-27,32-38,43-49" class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">// src/routes.js
import { prepareRoutes } from &quot;@curi/router&quot;;
import { preferDefault } from &quot;@curi/helpers&quot;;

export default prepareRoutes([
  {
    name: &quot;Home&quot;,
    path: &quot;&quot;,
    resolve() {
      return import(&quot;./components/Home&quot;)
        .then(preferDefault);
    },
    respond({ resolved }) {
      return { body: resolved };
    }
  },
  {
    name: &quot;Book&quot;,
    path: &quot;book/:id&quot;,
    resolve() {
      return import(&quot;./components/Book&quot;)
        .then(preferDefault);
    },
    respond({ resolved }) {
      return { body: resolved };
    }
  },
  {
    name: &quot;Checkout&quot;,
    path: &quot;checkout&quot;,
    resolve() {
      return import(&quot;./components/Checkout&quot;)
        .then(preferDefault);
    },
    respond({ resolved }) {
      return { body: resolved };
    }
  },
  {
    name: &quot;Catch All&quot;,
    path: &quot;(.*)&quot;,
    resolve() {
      return import(&quot;./components/NotFound&quot;)
        .then(preferDefault);
    },
    respond({ resolved }) {
      return { body: resolved };
    }
  }
]);</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg ">For this tutorial, we will use <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">router.once</code> to delay the initial render while we wait for the initial response. We should update the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">index.js</code> module to do this.</p><figure class="m-0 mb-4"><pre data-line="22-28" class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">// src/index.js
import React from &#x27;react&#x27;;
import ReactDOM from &#x27;react-dom&#x27;;
import { createRouter, announce } from &quot;@curi/router&quot;;
import { browser } from &#x27;@hickory/browser&#x27;;
import { createRouterComponent } from &#x27;@curi/react-dom&#x27;;

import routes from &#x27;./routes&#x27;;
import &#x27;./index.css&#x27;;
import NavMenu from &#x27;./components/NavMenu&#x27;;
import registerServiceWorker from &#x27;./registerServiceWorker&#x27;;

let router = createRouter(browser, routes, {
  sideEffects: [
    announce(({ response }) =&gt; {
      return `Navigated to ${response.location.pathname}`;
    })
  ]
});
let Router = createRouterComponent(router);

router.once(() =&gt; {
  ReactDOM.render((
    &lt;Router&gt;
      &lt;App /&gt;
    &lt;/Router&gt;
  ), document.getElementById(&#x27;root&#x27;));
});
registerServiceWorker();</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg ">With those changes, Webpack will now split the application into multiple bundles. The initial render will be delayed until after the code split bundle for the first route has been loaded.</p></section><section class="mt-3 md:max-w-2xl"><h2 id="preloading-data" class="hash-anchor-fix outline-none" tabindex="-1"><a class="header-link no-underline" href="#preloading-data">Preloading Data</a></h2><p class="m-0 mb-4 text-base md:text-lg ">Preloading data lets you delay navigation until after the data for a route has loaded. This can save you from having to render a partial page with spinners if the data takes a while to load.</p><p class="m-0 mb-4 text-base md:text-lg ">While the data is loading, the user will be able to continue interacting with the current page. This means that the user can also start a new navigation while the current navigation is running. When this happens, Curi knows to to cancel the previous navigation and perform the new navigation instead.</p><p class="m-0 mb-4 text-base md:text-lg ">We have two routes that need to load data: <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Home</code> and<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Book</code>. The <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Home</code> route will load the known books, while the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Book</code> route will load data about a specific book.</p><p class="m-0 mb-4 text-base md:text-lg ">Currently the data for both of these routes is imported in their components. In a real site you would most likely make API calls to a REST or GraphQL endpoint, but here we will simulate this with a fake API.</p><section class="mt-3 md:max-w-2xl"><h3 id="fake-api" class="hash-anchor-fix outline-none" tabindex="-1"><a class="header-link no-underline" href="#fake-api">The Fake API</a></h3><p class="m-0 mb-4 text-base md:text-lg ">The fake API will simulate asynchronous calls to the server by returning Promises, similarly to the<!-- --> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a>.</p><p class="m-0 mb-4 text-base md:text-lg ">First, we will create an <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">api.js</code> module that exports the fake API functions.</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-bash md:whitespace-pre-wrap">touch src/api.js</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg ">In the API module, we will import the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">books.js</code> data.</p><p class="m-0 mb-4 text-base md:text-lg ">We need to write two functions. The first returns a list of all books and the second returns the data for a specific book. For both, we can use <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Promise.resolve</code> to return a Promise, even though we don&#x27;t really have any asynchronous code being run.</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">// src/api.js
import books from &quot;./books&quot;;

export let BOOKS = () =&gt; Promise.resolve(books);

export let BOOK = id =&gt; Promise.resolve(
  let intID = parseInt(id, 10);
  books.find(b =&gt; b.id === intID)
);</code></pre></figure></section><p class="m-0 mb-4 text-base md:text-lg ">When the router is created, it can take a third argument, which is an options object. One of the properties of this object is<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">external</code>, which is used to pass in external values that will be accessible in a route&#x27;s <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">resolve</code> and<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">respond</code> functions. This is particularly useful for data that is initialized at runtime, like an Apollo store, but we will also use it here.</p><figure class="m-0 mb-4"><pre data-line="11,20-22" class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">// src/index.js
import React from &#x27;react&#x27;;
import ReactDOM from &#x27;react-dom&#x27;;
import { createRouter } from &quot;@curi/router&quot;;
import { browser } from &#x27;@hickory/browser&#x27;;
import { createRouterComponent } from &#x27;@curi/react-dom&#x27;;

import routes from &#x27;./routes&#x27;;
import &#x27;./index.css&#x27;;
import NavMenu from &#x27;./components/NavMenu&#x27;;
import * as bookAPI from &quot;./api&quot;;
import registerServiceWorker from &#x27;./registerServiceWorker&#x27;;

let router = createRouter(browser, routes, {
  sideEffects: [
    announce(({ response }) =&gt; {
      return `Navigated to ${response.location.pathname}`;
    })
  ],
  external: {
    bookAPI
  }
});
let Router = createRouterComponent(router);

router.once(() =&gt; {
  ReactDOM.render((
    &lt;Router&gt;
      &lt;App /&gt;
    &lt;/Router&gt;
  ), document.getElementById(&#x27;root&#x27;));
});
registerServiceWorker();</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg ">What do we want to do with the data loaded from the API calls? Along with the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">body</code> property, another valid return property for<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">respond</code> functions is <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">data</code>. This is a convenient way to attach any data to a response, which we can read from while rendering.</p><p class="m-0 mb-4 text-base md:text-lg ">The <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Home</code> route already has an asynchronous action: importing the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">body</code> component. We will name the async call to load the books data <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">&quot;books&quot;</code>.</p><p class="m-0 mb-4 text-base md:text-lg ">The <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Book</code> route&#x27;s <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">respond</code> function also needs to be updated to attach the books data (<code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">resolved.books</code>) to the response.</p><p class="m-0 mb-4 text-base md:text-lg ">The <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">book</code> API call expects to be given the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">id</code> <!-- -->number of the book it should return data for. We can grab the correct param (<code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">id</code>) from the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">params</code> property. However, when params are parsed, they are stored as strings. To convert it to a number, we can use the route&#x27;s <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">params</code> property to tell Curi how to parse the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">id</code>. By giving it a function that calls<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">parseInt</code> on the provided value, <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">params.id</code> will be a number instead of a string.</p><figure class="m-0 mb-4"><pre data-line="10,13,17-21,27,30,34-38" class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">// src/routes.js
import { prepareRoutes } from &quot;@curi/router&quot;;
import { preferDefault } from &quot;@curi/helpers&quot;;

export default prepareRoutes([
  {
    name: &quot;Home&quot;,
    path: &quot;&quot;,
    resolve(_, external) {
      let body = import(&quot;./components/Home&quot;)
        .then(preferDefault);
      let books = external.bookAPI.BOOKS();
      return Promise.all([body, books]);
    },
    respond({ resolved }) {
      let [body, books] = resolved;
      return {
        body,
        data: { books }
      };
    }
  },
  {
    name: &quot;Book&quot;,
    path: &quot;book/:id&quot;,
    resolve({ params }, external) {
      let body = import(&quot;./components/Book&quot;)
        .then(preferDefault);
      let book = external.bookAPI.BOOK(params.id);
      return Promise.all([body, books]);
    },
    respond({ resolved }) {
      let [body, book] = resolved;
      return {
        body,
        data: { book }
      };
    }
  },
  {
    name: &quot;Checkout&quot;,
    path: &quot;checkout&quot;,
    resolve() {
      return import(&quot;./components/Checkout&quot;)
        .then(preferDefault);
    },
    respond({ resolved }) {
      return { body: resolved };
    }
  },
  {
    name: &quot;Catch All&quot;,
    path: &quot;(.*)&quot;,
    resolve() {
      return import(&quot;./components/NotFound&quot;)
        .then(preferDefault);
    },
    respond({ resolved }) {
      return { body: resolved };
    }
  }
]);</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg ">With the data attached to our responses, we can remove the data imports from the components and just read from the response.</p><p class="m-0 mb-4 text-base md:text-lg ">In the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Home</code> component&#x27;s module, we can remove the<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">books.js</code> import and grab the response from the component&#x27;s props. The books data can be access as <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">response.data.books</code>.</p><figure class="m-0 mb-4"><pre data-line="5,9" class="align-top h-full whitespace-pre-wrap"><code class="language-jsx md:whitespace-pre-wrap">// src/components/Home.js
import React from &#x27;react&#x27;;
import { Link } from &#x27;@curi/react-dom&#x27;;

export default function Home({ response }) {
  return (
    &lt;article&gt;
      &lt;ul&gt;
        {response.data.books.map(book =&gt; (
          &lt;li key={book.id}&gt;
            &lt;Link name=&quot;Book&quot; params={{ id: book.id }} &gt;
              {book.title} by {book.author}
            &lt;/Link&gt;
          &lt;/li&gt;
        ))}
      &lt;/ul&gt;
    &lt;/article&gt;
  );
}</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg ">Likewise, we can remove the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">books.js</code> import from the<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Book</code> component&#x27;s module and grab the book data from<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">response.data</code> instead of searching for it in the books array.</p><figure class="m-0 mb-4"><pre data-line="9" class="align-top h-full whitespace-pre-wrap"><code class="language-jsx md:whitespace-pre-wrap">// src/components/Book.js
import React from &#x27;react&#x27;;
import { useRouter } from &#x27;@curi/react-dom&#x27;;

import cart from &#x27;../cart&#x27;;

export default function Book({ response }) {
  let router = useRouter();
  let { book } = response.data;
  if (!book) {
    return &lt;article&gt;The requested book could not be found&lt;/article&gt;;
  }
  return (
    &lt;article&gt;
      &lt;h1&gt;{book.title}&lt;/h1&gt;
      &lt;h2&gt;by {book.author}&lt;/h2&gt;
      &lt;Paragraph&gt;Published in {book.published}&lt;/Paragraph&gt;
      &lt;Paragraph&gt;{book.pages} pages&lt;/Paragraph&gt;
      &lt;button
        type=&quot;button&quot;
        onClick={() =&gt; {
          cart.add(book, 1);
          let url = router.url({ name: &quot;Checkout&quot; });
          router.navigate({ url });
        }}
      &gt;
        Add to Cart
      &lt;/button&gt;
    &lt;/article&gt;
  );
};</code></pre></figure></section><section class="mt-3 md:max-w-2xl"><h2 id="loading" class="hash-anchor-fix outline-none" tabindex="-1"><a class="header-link no-underline" href="#loading">Visualizing Loading</a></h2><p class="m-0 mb-4 text-base md:text-lg ">At this point, we have the same functionality as the basic tutorial, but we have added async data loading. The bundle importing has real loading times, but the fake API calls resolve immediately, which doesn&#x27;t necessarily reflect real world performance.</p><p class="m-0 mb-4 text-base md:text-lg ">We can update the fake API to delay resolving so that we can take a look at some of the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">@curi/react-dom</code> components that are navigation-aware. The implementation here isn&#x27;t important, so you can just copy+paste the code. The only thing to know is that the<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">BOOKS</code> function has a one second delay and the<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">BOOK</code> function has a 2.5 second delay the first time a book is requested (and responds instantly on subsequent calls).</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-javascript md:whitespace-pre-wrap">// src/api.js
import books from &quot;./books&quot;;

export let BOOKS = () =&gt; new Promise(resolve =&gt; {
  // artificial delay
  setTimeout(() =&gt; {
    resolve(books);
  }, 1000);
});

let BOOK_CACHE = {};
export let BOOK = id =&gt; new Promise(resolve =&gt; {
  if (BOOK_CACHE[id]) {
    resolve(BOOK_CACHE[id]);
    return;
  }
  let intID = parseInt(id, 10);
  // artificial delay on first call
  setTimeout(() =&gt; {
    let book = books.find(b =&gt; b.id === id);
    BOOK_CACHE[id] = book;
    resolve(book);
  }, 2500);
});</code></pre></figure><section class="mt-3 md:max-w-2xl"><h3 id="link-navigating" class="hash-anchor-fix outline-none" tabindex="-1"><a class="header-link no-underline" href="#link-navigating">Link is navigating?</a></h3><p class="m-0 mb-4 text-base md:text-lg ">The <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Link</code> component has a sibling component called<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">AsyncLink</code>, can takes a render-invoked function as its<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">children</code> prop. The function is called with a<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">navigating</code> boolean that indicates whether the router is currently navigating to that link. This is useful for when you know that there is a long (multiple seconds) delay between when the user clicks the link and when the navigation will occur.</p><p class="m-0 mb-4 text-base md:text-lg ">We can replace the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Link</code>s in the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Home</code> component with <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">AsyncLink</code>s and use render-invoked functions to display a loading spinner while we wait for the book data to load.</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-jsx md:whitespace-pre-wrap">import { AsyncLink } from &quot;@curi/react-dom&quot;;

&lt;AsyncLink name=&quot;Book&quot; params={{ id: 1 }}&gt;
  {navigating =&gt; (
    &lt;React.Fragment&gt;
      Book 1
      {navigating ? &lt;Spinner /&gt; : null}
    &lt;/React.Fragment&gt;
  )}
&lt;/AsyncLink&gt;</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg ">We will use the<!-- --> <a href="https://github.com/KyleAMathews/react-spinkit"><code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">react-spinkit</code></a> <!-- -->package, which provides a variety of spinner components.</p><figure class="m-0 mb-4"><pre class="align-top h-full whitespace-pre-wrap"><code class="language-bash md:whitespace-pre-wrap">npm install react-spinkit</code></pre></figure><p class="m-0 mb-4 text-base md:text-lg ">In the <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Home</code> component&#x27;s module, we need to import the<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Spinner</code> component. The <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Link</code> needs to be swapped from a React element to a render-invoked function. We wrap the contents in a <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">React.Fragment</code> to avoid unnecessary DOM elements. In the function, we render a <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Spinner</code> when the<!-- --> <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">Link</code> is navigating and <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">null</code> when it is not.</p><aside class="py-2 px-1 my-1 mx-0 border-gray-300 bg-gray-200"><strong>Note:</strong> <p class="m-0 mb-4 text-base md:text-lg "><code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">react-spinkit</code> is highly customizable, but we are sticking with the defaults here. <code class=" p-1 rounded whitespace-normal background-white text-purple" style="text-shadow:none">react-spinkit</code> has a default one second render delay, which is why the spinner does not display immediately.</p></aside><figure class="m-0 mb-4"><pre data-line="3-4,12-19" class="align-top h-full whitespace-pre-wrap"><code class="language-jsx md:whitespace-pre-wrap">// src/components/Home.js
import React from &#x27;react&#x27;;
import { AsyncLink } from &#x27;@curi/react-dom&#x27;;
import Spinner from &quot;react-spinkit&quot;;

export default function Home({ response }) {
  return (
    &lt;article&gt;
      &lt;ul&gt;
        {response.data.books.map(book =&gt; (
          &lt;li key={book.id}&gt;
            &lt;AsyncLink name=&quot;Book&quot; params={{ id: book.id }} &gt;
              {navigating =&gt; (
                &lt;React.Fragment&gt;
                  {book.title} by {book.author}
                  {navigating ? &lt;Spinner /&gt; : null}
                &lt;/React.Fragment&gt;
              )}
            &lt;/AsyncLink&gt;
          &lt;/li&gt;
        ))}
      &lt;/ul&gt;
    &lt;/article&gt;
  );
}</code></pre></figure></section></section><section class="mt-3 md:max-w-2xl"><h2 id="caveats" class="hash-anchor-fix outline-none" tabindex="-1"><a class="header-link no-underline" href="#caveats">Async Caveats</a></h2><p class="m-0 mb-4 text-base md:text-lg ">Adding asynchronous loading to an application can help reduce initial load size and speed up user interactions, however it also has some issues that you will need to consider.</p><p class="m-0 mb-4 text-base md:text-lg ">The biggest consideration is that there is nothing the frontend can do to get the data for the initial render faster. Your application&#x27;s frontend can only fetch data as it discovers it needs it. If you are performing server-side rendering, you may want to load the initial data on the server and inject it into the page&#x27;s HTML output. The implementation details for this vary greatly and are more related to how you store data (e.g.<!-- --> <a href="https://redux.js.org/recipes/server-rendering#the-server-side">with redux</a>).</p><p class="m-0 mb-4 text-base md:text-lg ">Another consideration is whether or not you want to &quot;hoist&quot; data requirements. Curi&#x27;s async functionality relies on you knowing all of the data requirements for a route, but you might prefer to keep the data associated with individual components. React Suspense will help with this (and Curi will support it once it releases), but this is still a ways out. At the very least, I would recommend using Curi for code splitting routes. Whether your should hoist other data requirements is something that should be determined on a case-by-case basis.</p></section></article></div></main></div>
    <script src="https://unpkg.com/react@16.13.1/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16.13.1/umd/react-dom.production.min.js"></script>
    <script src="/static/js/highlight.js"></script>
    <script src="/static/js/bundle.js"></script>
  </body>
</html>
