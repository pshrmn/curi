<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="Learn how to use Curi router observers to react to new responses">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New Responses Guide | Curi Documentation</title>
    <link href="https://fonts.googleapis.com/css?family=Zilla+Slab:300,400" rel="stylesheet">
    <link href="/static/css/prism.css" rel="stylesheet">
  </head>
  <body>
    <div id="root"><style data-emotion-css="w4dmsu">body{font-family:"Zilla Slab",serif;font-weight:300;font-size:24px;line-height:36px;margin:0;box-sizing:border-box;}@media only screen and (min-width:751px){body{font-size:20px;}}*,*:before,*:after{box-sizing:inherit;}h1,h2,h3,h4,h5,h6{font-weight:normal;margin:5px 0;overflow:hidden;text-overflow:ellipsis;}p{margin:5px 0;word-break:break-word;}h1{font-size:1.75em;line-height:1.5em;}h2{font-size:1.5em;line-height:1.2em;}h3{font-size:1.35em;line-height:1.1em;}h4{font-size:1.2em;line-height:1.1em;}h5{font-size:1.1em;line-height:1.1em;}h6{font-size:1em;line-height:1.1em;}table,th,td{border:1px solid #c7c7c7;border-collapse:collapse;}table{margin-bottom:10px;}th{text-align:left;}th,td{padding:10px;}pre[class*="language-"]{margin:0;background:#222233;}:not(pre) > code[class*="language-"]{white-space:nowrap;}menu{padding:0;margin:0;}</style><style data-emotion-css="137i3vd">.css-137i3vd{display:none;}@media only screen and (min-width:751px){.css-137i3vd{display:block;width:100vw;max-width:100%;background:#222233;padding:0;position:fixed;z-index:1;}.css-137i3vd #home-link{font-size:1.5em;color:#ff9800;}}</style><header class="css-137i3vd e132noc00"><style data-emotion-css="1j4n5ho">.css-1j4n5ho{color:#efefef;}.css-1j4n5ho li{margin-right:20px;padding:0;}.css-1j4n5ho li.base > a{color:#efefef;font-size:1.1em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:50px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:3px solid #222233;padding:0 5px;}.css-1j4n5ho li.base > a:hover{color:#ff9800;}.css-1j4n5ho li.base > a.active{color:#ff9800;border-bottom-color:#ff9800;}.css-1j4n5ho li.base > a.activated{color:#2196f3;border-bottom-color:#2196f3;}.css-1j4n5ho a{-webkit-text-decoration:none;text-decoration:none;}</style><nav class="css-1j4n5ho e132noc02"><style data-emotion-css="192aemx">.css-192aemx{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:row wrap;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;list-style:none;padding:0;margin:0;max-width:100%;}</style><ul class="css-192aemx e132noc01"><li class="base"><a id="home-link" class=" " href="/">Curi</a></li><li class="base"><a data-hide="false" class="group " href="/v2/">API</a></li><li class="base"><a data-hide="false" class="group active" href="/guides/">Guides</a></li><li class="base"><a data-hide="false" class="group " href="/tutorial/">Tutorials</a></li><li class="base"><a data-hide="false" class="group " href="/examples/">Examples</a></li><li class="base"><a href="https://github.com/pshrmn/curi">GitHub</a></li></ul></nav></header><style data-emotion-css="1y5vav3">.css-1y5vav3{position:fixed;width:100vw;height:40px;left:0;bottom:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:row nowrap;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;z-index:9999;}</style><menu class="css-1y5vav3 e18ecyrg1"><style data-emotion-css="xp11l1">.css-xp11l1{height:40px;border:0;font-size:1em;font-family:"Zilla Slab",serif;-webkit-flex:1;-ms-flex:1;flex:1;background:#c8e6c9;}.css-xp11l1.active{background:#ef9a9a;}@media only screen and (min-width:751px){.css-xp11l1{display:none;}}</style><button class="false main css-xp11l1 e1105ass0">Main Menu</button><style data-emotion-css="18i6c1d">.css-18i6c1d{height:40px;border:0;font-size:1em;font-family:"Zilla Slab",serif;-webkit-flex:1;-ms-flex:1;flex:1;background:#b3e5fc;}.css-18i6c1d.active{background:#ef9a9a;}@media only screen and (min-width:751px){.css-18i6c1d{display:none;}}</style><button class="false page css-18i6c1d e1105ass1">Page Menu</button></menu><style data-emotion-css="1m8byth">.css-1m8byth{position:fixed;overflow-y:scroll;width:100vw;height:100vh;background:#efefef;z-index:999;padding:15px 15px 45px;}.css-1m8byth.visible{display:block;}.css-1m8byth ul{margin:3px 0;padding-left:0px;list-style:none;}.css-1m8byth li{margin:3px 0;}.css-1m8byth a{-webkit-text-decoration:none;text-decoration:none;display:inline-block;color:#222233;}.css-1m8byth h3{border-bottom:1px solid #333;}.css-1m8byth .active{font-weight:bold;}.css-1m8byth .children{display:none;background:#efefef;padding:10px;}.css-1m8byth .children.visible{display:block;position:fixed;top:0;bottom:0;left:0;right:0;overflow-y:scroll;}@media only screen and (min-width:751px){.css-1m8byth{display:none;}.css-1m8byth.visible{display:none;}}</style><menu hidden="" class=" css-1m8byth e18ecyrg0"><nav></nav></menu><style data-emotion-css="13rb4cr">.css-13rb4cr{width:100vw;max-width:100%;padding:10px 10px 0;margin-bottom:45px;}.css-13rb4cr a{color:#222233;}@media only screen and (min-width:751px){.css-13rb4cr{padding:50px 0 0;margin-bottom:0;}}</style><main tabindex="-1" style="outline:none" class="css-13rb4cr e1fl12nk0"><style data-emotion-css="csv88t">.css-csv88t{position:relative;}@media only screen and (min-width:751px){.css-csv88t{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:row nowrap;-ms-flex-flow:row nowrap;flex-flow:row nowrap;}}@media only screen and (min-width:751px){.css-csv88t{max-width:100vw;}}</style><div class="css-csv88t e1hcridg0"><style data-emotion-css="q1fc1d">@media only screen and (min-width:751px){.css-q1fc1d{margin-left:275px;}}</style><article class="css-q1fc1d e1hcridg1"><style data-emotion-css="gmhjbe">.css-gmhjbe{margin-top:15px;}.css-gmhjbe p{margin:0 0 25px;font-size:0.8em;}@media only screen and (min-width:751px){.css-gmhjbe{max-width:751px;}.css-gmhjbe p{font-size:1em;}.css-gmhjbe.centered{margin:0 auto;}}</style><section class="section css-gmhjbe"><h1>New Responses</h1><p>Curi uses an observer pattern to call registered functions (called response handlers) when there is a new response. The primary use care for this is to re-render the application whenever there is a new response, but other functionalities (like logging) can also be performed.</p></section><section class="css-gmhjbe e1a46ijo0"><style data-emotion-css="1gka4o8">.css-1gka4o8 .header-link{-webkit-text-decoration:none;text-decoration:none;}.css-1gka4o8 .header-link::after{content:"#";color:#333;margin-left:5px;}@media only screen and (min-width:751px){.css-1gka4o8{margin-top:-50px;padding-top:50px;}.css-1gka4o8 .header-link::after{display:none;}.css-1gka4o8 .header-link:hover::after{display:inline-block;}}</style><h2 id="response-handlers" class="css-1gka4o8"><a class="header-link" href="#response-handlers">Response Handlers</a></h2><p>When response handlers are called, they are passed an object with three properties:<!-- --> <a href="/v2/@curi/router/#properties"><style data-emotion-css="jo5c25">.css-jo5c25{padding:0.1em;border-radius:0.3em;white-space:normal;background:#fff;color:#222233;text-shadow:none;white-space:wrap;}.css-jo5c25 .token{color:#222233;}</style><code class="inline-code css-jo5c25 eutm4hs0">router</code></a>,<!-- --> <a href="/guides/responses/"><code class="inline-code css-jo5c25 eutm4hs0">response</code></a>, and<!-- --> <a href="/guides/navigation-objects/"><code class="inline-code css-jo5c25 eutm4hs0">navigation</code></a>. Which objects/properties you use depends on what the response handler is doing.</p><style data-emotion-css="xg7t84">.css-xg7t84{width:100%;margin:0 0 25px;font-size:0.8em;}.css-xg7t84 pre{white-space:pre-wrap;height:100%;vertical-align:top;}@media only screen and (min-width:751px){.css-xg7t84{font-size:1em;}.css-xg7t84 code{min-width:200px;white-space:pre-wrap;}}</style><figure class="css-xg7t84 e12etsbl0"><pre><code class="language-javascript">function responseHandler({
  router,
  response,
  navigation
}) {
  // ...
}</code></pre></figure></section><section class="css-gmhjbe e1a46ijo0"><h2 id="registering" class="css-1gka4o8"><a class="header-link" href="#registering">Registering Response Handlers</a></h2><p>There are three ways to attach response handlers to the router:<!-- --> <code class="inline-code css-jo5c25 eutm4hs0">router.once</code> and <code class="inline-code css-jo5c25 eutm4hs0">router.observe</code> or as a side effect.</p><p>Response handlers registered with <code class="inline-code css-jo5c25 eutm4hs0">router.once</code> will only be called one time, while those registered with <code class="inline-code css-jo5c25 eutm4hs0">router.observe</code> <!-- -->and side effects will be called for every new response.</p><p>When you register a response handler using <code class="inline-code css-jo5c25 eutm4hs0">router.observe</code>, it will return a function that you can use to stop calling the response handler for new responses. You should rarely need to do this, but it can be useful for memory management if you are adding and removing lots of observers.</p><figure class="css-xg7t84 e12etsbl0"><pre><code class="language-javascript">// fn will only be called one time
router.once(fn);

// obs will be called for every new response
const stop = router.observe(fn);</code></pre></figure></section><section class="css-gmhjbe e1a46ijo0"><h2 id="use-cases" class="css-1gka4o8"><a class="header-link" href="#use-cases">Use Cases</a></h2><p>What should you use response handlers for?</p><section class="css-gmhjbe e1a46ijo0"><h3 id="setup" class="css-1gka4o8"><a class="header-link" href="#setup">Setup</a></h3><p>If any of the routes in an application have <code class="inline-code css-jo5c25 eutm4hs0">resolve</code> <!-- -->functions, when they match their responses are created asynchronously. When the application first renders, if the router matches an async route, the response isn&#x27;t immediately ready to use. To deal with this, you can use an observer to render once the initial response is ready.</p><p>A setup function only needs to be called one time, so you can register it with <code class="inline-code css-jo5c25 eutm4hs0">router.once</code>.</p><style data-emotion-css="10wffac">.css-10wffac{padding:10px 5px;margin:5px 0;border:1px solid #c7c7c7;background:#eeeeee;}.css-10wffac p:last-child{margin-bottom:0;}.css-10wffac .inline-code{background:#fff !important;}</style><aside class="css-10wffac e1bjkffy0"><strong>Note:</strong> <p>In most applications, waiting for the initial response is the only time you may need to write response handlers yourself.</p></aside><figure class="css-xg7t84 e12etsbl0"><pre><code class="language-jsx">const Router = createRouterComponent(router);

function setup() {
  ReactDOM.render((
    &lt;Router&gt;
      &lt;App /&gt;
    &lt;/Router&gt;
  ), document.getElementById(&#x27;root&#x27;));
}

router.once(setup);</code></pre></figure></section><section class="css-gmhjbe e1a46ijo0"><h3 id="rendering" class="css-1gka4o8"><a class="header-link" href="#rendering">Rendering</a></h3><p>Rendering libraries need to know when there is a new response so that they can re-render the application.</p><p>The Curi rendering packages (<a href="/v2/@curi/react-dom/"><code class="inline-code css-jo5c25 eutm4hs0">@curi/react-dom</code></a>,<!-- --> <a href="/v2/@curi/react-native/"><code class="inline-code css-jo5c25 eutm4hs0">@curi/react-native</code></a>,<!-- --> <a href="/v1/@curi/vue/"><code class="inline-code css-jo5c25 eutm4hs0">@curi/vue</code></a>, and<!-- --> <a href="/v1/@curi/svelte/"><code class="inline-code css-jo5c25 eutm4hs0">@curi/svelte</code></a>) setup an observer internally so that they can automatically re-render.</p><p>If you are using vanilla JavaScript to render your application or you are writing your own framework implementation, you would use<!-- --> <code class="inline-code css-jo5c25 eutm4hs0">router.observe</code> to re-render new responses.</p><figure class="css-xg7t84 e12etsbl0"><pre><code class="language-javascript">function observer({ response }) {
  // let the app know there is a new response
}

router.observe(observer);</code></pre></figure></section><section class="css-gmhjbe e1a46ijo0"><h3 id="side-effects" class="css-1gka4o8"><a class="header-link" href="#side-effects">Side Effects</a></h3><p>Side effects are observers that are provided to the router at creation instead of by calling <code class="inline-code css-jo5c25 eutm4hs0">router.observe</code>. These can be useful for tasks that are not rendering related as well as for tasks that need to be performed after a render has completed.</p><p>The<!-- --> <a href="/v2/@curi/router/#title"><code class="inline-code css-jo5c25 eutm4hs0">title</code></a> <!-- -->function exported by <code class="inline-code css-jo5c25 eutm4hs0">@curi/router</code> is a side effect that will use <code class="inline-code css-jo5c25 eutm4hs0">response.meta.title</code> to set the page&#x27;s<!-- --> <code class="inline-code css-jo5c25 eutm4hs0">document.title</code>.</p><p>With single-page applications, clicking on links wish hashes won&#x27;t always scroll to the matching element in the page. The<!-- --> <a href="/v2/@curi/router/#scroll"><code class="inline-code css-jo5c25 eutm4hs0">scroll</code></a> <!-- -->function exported by <code class="inline-code css-jo5c25 eutm4hs0">@curi/router</code> is a side effect that scrolls the page to the element that matches the new response&#x27;s hash (<code class="inline-code css-jo5c25 eutm4hs0">response.location.hash</code>) after the new response has rendered.</p><p>If you need to add logging to your application, you could write your own observer to do this. Your observer can either be added as a side effect when the router is constructed or later using<!-- --> <code class="inline-code css-jo5c25 eutm4hs0">router.observe</code>.</p><figure class="css-xg7t84 e12etsbl0"><pre><code class="language-javascript">function logger({ response }) {
  loggingAPI.add(response.location);
}

// as a side-effect
const router = createRouter(browser, routes, {
  sideEffects: [{ fn: logger }]
});

// as an observer
router.observe(logger);</code></pre></figure></section></section></article><style data-emotion-css="64fwtw">.css-64fwtw{display:none;}@media only screen and (min-width:751px){.css-64fwtw{background:#efefef;display:block;position:fixed;top:50px;bottom:0px;overflow:auto;-webkit-flex:0 0;-ms-flex:0 0;flex:0 0;-webkit-order:-1;-ms-flex-order:-1;order:-1;padding:25px;margin-right:25px;}}</style><div class="css-64fwtw e1hcridg2"><style data-emotion-css="gnbpx8">.css-gnbpx8{width:200px;padding:0;margin:0;}.css-gnbpx8 p{margin:0;}.css-gnbpx8 a{-webkit-text-decoration:none;text-decoration:none;display:block;}.css-gnbpx8 ol{padding-left:0;margin-top:0;list-style-type:none;}.css-gnbpx8 ol ol{padding-left:15px;font-size:0.9em;}</style><menu class="css-gnbpx8 e1evhjzy0"><ol><li><a href="#response-handlers">Response Handlers</a></li><li><a href="#registering">Registering Response Handlers</a></li><li><a href="#use-cases">Use Cases</a><ol><li><a href="#setup">Setup</a></li><li><a href="#rendering">Rendering</a></li><li><a href="#side-effects">Side Effects</a></li></ol></li></ol></menu></div></div></main></div>
    <script src="https://unpkg.com/react@16.8.6/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16.8.6/umd/react-dom.production.min.js"></script>
    <script src="/static/js/highlight.js"></script>
    <script src="/static/js/bundle.js"></script>
  </body>
</html>
