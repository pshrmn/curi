<a {...forward} href="{url}" on:click="handleClick(event)">
  {#if wrapper}
  <svelte:component this="{wrapper}" navigating="{navigating}">
    <slot></slot>
  </svelte:component>
  {:else}
  <slot></slot>
  {/if}
</a>

<script>
  const canNavigate = event => {
    return (
      !event.defaultPrevented &&
      event.button === 0 &&
      !(event.metaKey || event.altKey || event.ctrlKey || event.shiftKey)
    );
  };

  export default {
    data() {
      return {
        name: undefined,
        params: {},
        hash: "",
        query: "",
        state: null,
        navigating: false
      };
    },
    computed: {
      url: ({ name, params, hash, query, $router }) => {
        return $router.url({ name, params, hash, query });
      }
    },
    methods: {
      handleClick(event) {
        if (canNavigate(event)) {
          const { $router, url, state, wrapper } = this.get();
          event.preventDefault();
          let cancelled, finished;
          if (wrapper) {
            cancelled = finished = () => {
              this.cancelCallbacks = undefined;
              this.set({ navigating: false });
            };
            this.set({ navigating: true });
          }
          this.cancelCallbacks = $router.navigate({
            url,
            state,
            cancelled,
            finished
          });
        }
      }
    },
    ondestroy() {
      if (this.cancelCallbacks) {
        this.cancelCallbacks();
      }
    }
  };
</script>
