<a href="{href}" on:click="handle_click(event)" {...forward}>
  {#if wrapper}
  <svelte:component this="{wrapper}" navigating="{navigating}">
    <slot></slot>
  </svelte:component>
  {:else}
  <slot></slot>
  {/if}
</a>

<script>
  const can_navigate = event => {
    return (
      !event.defaultPrevented &&
      event.button === 0 &&
      !(event.metaKey || event.altKey || event.ctrlKey || event.shiftKey)
    );
  };

  export default {
    data() {
      return {
        name: "",
        params: {},
        hash: "",
        query: "",
        state: null,
        navigating: false
      };
    },
    computed: {
      location: ({ name, params, hash, query, state, $router }) => {
        return {
          pathname: name ? $router.route.pathname(name, params) : "",
          hash,
          query,
          state
        };
      },
      href: ({ location, $router }) => {
        return $router.history.href(location);
      }
    },
    methods: {
      handle_click(event) {
        if (can_navigate(event)) {
          const {
            $router,
            name,
            params,
            hash,
            query,
            state,
            wrapper
          } = this.get();
          event.preventDefault();
          let cancelled, finished;
          if (wrapper) {
            cancelled = finished = () => {
              this.cancel_callbacks = undefined;
              this.set({ navigating: false });
            };
            this.set({ navigating: true });
          }
          this.cancel_callbacks = $router.navigate({
            name,
            params,
            hash,
            query,
            state,
            cancelled,
            finished
          });
        }
      }
    },
    ondestroy() {
      if (this.cancel_callbacks) {
        this.cancel_callbacks();
      }
    }
  };
</script>
